@model AccountingWebsite.Models.CompanyData

@{
    ViewData["Title"] = "Expenses";
}

<link rel="stylesheet" href="~/css/company/transaction.css" asp-append-version="true" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!DOCTYPE html>
<html>
<head>
    <title>Expense Transactions</title>
</head>
<body>

    <h1>Expense Transactions</h1>
    <div class="table-container">
    <table>
        <thead>
            <tr>
                <th>Amount</th>
                <th>Transaction Date</th>
                <th>Description</th>
                <th>Edit or Delete</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var transaction in Model.QuarterlyTransactions.Where(t => t.TransactionType == 2))
            {
                <tr>
                    <td>@transaction.Amount</td>
                    <td>@transaction.TransactionDate.ToString("yyyy-MM-dd")</td>
                    <td>@transaction.Description</td>
                    <td>
                        <a href="#" onclick="openEditModal(@transaction.Id, @transaction.Amount, '@transaction.TransactionDate.ToString("yyyy-MM-dd")', '@transaction.Description')">Edit</a> |
                            <a href="#" onclick="openDeleteModal(@transaction.Id, @transaction.Amount, '@transaction.TransactionDate.ToString("yyyy-MM-dd")', '@transaction.Description')">Delete</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
    </div>

    <div id="overlay">
        <div class="editOrDeleteModal" id="editOrDeleteModal">
        </div>
    </div>



    <!-- JavaScript for opening/closing modals -->
    <script>
        function openEditModal(id, amount, date, description) {
            document.getElementById("overlay").style.display = "block";
            document.getElementById("editOrDeleteModal").style.display = "block";



            document.getElementById('editOrDeleteModal').innerHTML = `
                                            <form asp-action="UpdateTransaction" asp-controller="Company" method="post">
                                <label>Amount:</label>
                                                <input type="hidden" name="itemId" value="${id}" />
                                                        <input name="amount" value="${amount}" />
                                                                         <input name="date" value="${date}" />
                                                                        <input name="description" value="${description}" />
                                        <button onclick="saveChanges()">Save Changes</button>
                            </form>
                                    <button onclick="closeEditOrDeleteModal()">Cancel</button>
                        `;
        }

        function closeEditOrDeleteModal() {
            document.getElementById("overlay").style.display = "none";
            document.getElementById("editOrDeleteModal").style.display = "none";
        }

        function openDeleteModal(id, amount, date, description) {
            document.getElementById("overlay").style.display = "block";
            document.getElementById("editOrDeleteModal").style.display = "block";

            document.getElementById('editOrDeleteModal').innerHTML = `
                                                    <form asp-action="DeleteTransaction" asp-controller="Company" method="post">
                                        <label>Amount:</label>
                                                                <input type="hidden" name="itemId" value="${id}" readonly/>
                                                                        <input name="amount" value="${amount}" readonly/>
                                                                                         <input name="date" value="${date}" readonly/>
                                                                                        <input name="description" value="${description}" readonly/>
                                                        <button onclick="deleteTransaction()">Delete Transaction</button>
                                    </form>
                                            <button onclick="closeEditOrDeleteModal()">Cancel</button>
                                `;
        }

        function saveChanges() {
            var formData = $('form').serialize();

            $.ajax({
                type: 'POST',
                url: '/Company/UpdateTransaction', // Adjust the URL based on your routing
                data: formData,
                success: function (response) {
                    // Handle success, if needed
                    alert('Transaction updated successfully!');
                    console.log(response);
                },
                error: function (error) {
                    // Handle error, if needed
                    console.error(error);
                }
            });

            // Close the modal
            closeEditModal();
        }

        function deleteTransaction() {
            var formData = $('form').serialize();

            $.ajax({
                type: 'POST',
                url: '/Company/DeleteTransaction', // Adjust the URL based on your routing
                data: formData,
                success: function (response) {
                    // Handle success, if needed
                    alert('Transaction updated successfully!');
                    console.log(response);
                },
                error: function (error) {
                    // Handle error, if needed
                    console.error(error);
                }
            });

            // Close the modal
            closeEditModal();
        }
    </script>

</body>
</html>