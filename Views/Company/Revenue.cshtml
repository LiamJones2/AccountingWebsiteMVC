@model AccountingWebsite.Models.CompanyData

<link rel="stylesheet" href="~/css/company/revenue.css" asp-append-version="true" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!DOCTYPE html>
<html>
<head>
    <title>Revenue Transactions</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>

    <h2>Revenue Transactions</h2>

    <table>
        <thead>
            <tr>
                <th>Amount</th>
                <th>Transaction Date</th>
                <th>Description</th>
                <th>Edit or Delete</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var transaction in Model.QuarterlyTransactions.Where(t => t.TransactionType == 1))
            {
                <tr>
                    <td>@transaction.Amount</td>
                    <td>@transaction.TransactionDate.ToString("yyyy-MM-dd")</td>
                    <td>@transaction.Description</td>
                    <td>
                        <a href="#" onclick="openEditModal(@transaction.Id, @transaction.Amount, '@transaction.TransactionDate.ToString("yyyy-MM-dd")', '@transaction.Description')">Edit</a> |
                        <a href="#" onclick="openDeleteModal(this)" data-transaction-id="@transaction.Id">Delete</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <div id="overlay">
        <div id="editModal">
            
        </div>
    </div>


    <!-- Delete Confirmation Modal -->
    <div id="deleteModal">
        <div id="deleteContent">
            <h2>Delete Transaction</h2>
            <p>Are you sure you want to delete this transaction?</p>
            <button onclick="deleteTransaction()">Delete</button>
            <button onclick="closeDeleteModal()">Cancel</button>
        </div>
    </div>


    <!-- JavaScript for opening/closing modals -->
    <script>
        function openEditModal(id, amount, date, description) {
            document.getElementById("overlay").style.display = "block";
            document.getElementById("editModal").style.display = "block";



            document.getElementById('editModal').innerHTML = `
                                    <form asp-action="UpdateTransaction" asp-controller="Company" method="post">
                        <label>Amount:</label>
                                        <input type="hidden" name="itemId" value="${id}" />
                                                <input name="amount" value="${amount}" />
                                                                 <input name="date" value="${date}" />
                                                                <input name="description" value="${description}" />
                                <button onclick="saveChanges()">Save Changes</button>
                    </form>
                    <button onclick="closeEditModal()">Cancel</button>
                `;

            console.log(document.getElementById('editModal').innerHTML);
        }

        function closeEditModal() {
            document.getElementById("overlay").style.display = "none";
            document.getElementById("editModal").style.display = "none";
        }

        function saveChanges() {
            var formData = $('form').serialize();

            $.ajax({
                type: 'POST',
                url: '/Company/UpdateTransaction', // Adjust the URL based on your routing
                data: formData,
                success: function (response) {
                    // Handle success, if needed
                    alert('Transaction updated successfully!');
                    console.log(response);
                },
                error: function (error) {
                    // Handle error, if needed
                    console.error(error);
                }
            });

            // Close the modal
            closeEditModal();
        }
    </script>

</body>
</html>